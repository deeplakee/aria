

------

## ðŸ§© aria bytecode

| æ“ä½œç å€¼ | æ“ä½œç åç§°          | 8ä½æ“ä½œç å€¼ | æ˜¾å¼æ“ä½œæ•°ï¼ˆä»Žå­—èŠ‚ç è¯»å–ï¼‰ | éšå¼æ“ä½œæ•°ï¼ˆä»Žæ ˆè¯»å–ï¼‰            | æ ˆå˜åŒ–ï¼ˆpop/pushï¼‰         | åŠŸèƒ½è¯´æ˜Ž                                                     |
| -------- | ------------------- | ----------- | -------------------------- | --------------------------------- | -------------------------- | ------------------------------------------------------------ |
| **1**    | `LOAD_CONST`        | 0x1         | 16ä½å¸¸é‡ç´¢å¼•               | â€”                                 | `push(const)`              | ä»Žå¸¸é‡æ± è¯»å–å¸¸é‡å¹¶åŽ‹å…¥æ ˆã€‚                                   |
| **2**    | `LOAD_NIL`          | 0x2         | â€”                          | â€”                                 | `push(nil)`                | åŽ‹å…¥ `nil` å€¼ã€‚                                              |
| **3**    | `LOAD_TRUE`         | 0x3         | â€”                          | â€”                                 | `push(true)`               | åŽ‹å…¥å¸ƒå°” `true`ã€‚                                            |
| **4**    | `LOAD_FALSE`        | 0x4         | â€”                          | â€”                                 | `push(false)`              | åŽ‹å…¥å¸ƒå°” `false`ã€‚                                           |
| **5**    | `LOAD_LOCAL`        | 0x5         | 16ä½åç§»é‡                 | â€”                                 | `push(local)`              | ä»Žå½“å‰å¸§å±€éƒ¨å˜é‡åŠ è½½å€¼ã€‚                                     |
| **6**    | `STORE_LOCAL`       | 0x6         | 16ä½åç§»é‡                 | æ ˆé¡¶å€¼                            | â€”                          | å°†æ ˆé¡¶å€¼å­˜å…¥å±€éƒ¨å˜é‡ã€‚                                       |
| **7**    | `LOAD_UPVALUE`      | 0x7         | 16ä½åç§»é‡                 | â€”                                 | `push(upvalue)`            | ä»Žé—­åŒ…æ•èŽ·çš„ä¸Šå€¼åŠ è½½ã€‚                                       |
| **8**    | `STORE_UPVALUE`     | 0x8         | 16ä½åç§»é‡                 | æ ˆé¡¶å€¼                            | â€”                          | å†™å…¥é—­åŒ…ä¸Šå€¼ã€‚                                               |
| **9**    | `CLOSE_UPVALUE`     | 0x9         | â€”                          | â€”                                 | â€”                          | å…³é—­å½“å‰æ´»åŠ¨ä¸Šå€¼ã€‚                                           |
| **10**   | `DEF_GLOBAL`        | 0xA         | 16ä½å¸¸é‡ç´¢å¼•               | æ ˆé¡¶å€¼                            | `pop()`                    | å®šä¹‰å…¨å±€å˜é‡ï¼ˆä»Žå¸¸é‡æ± èŽ·å–å˜é‡åï¼Œå®šä¹‰å…¨å±€å˜é‡ä¸ºæ ˆé¡¶å€¼ï¼‰ã€‚   |
| **11**   | `LOAD_GLOBAL`       | 0xB         | 16ä½å¸¸é‡ç´¢å¼•               | â€”                                 | `push(global)`             | åŠ è½½å…¨å±€å˜é‡ï¼ˆä»Žå¸¸é‡æ± èŽ·å–å…¨å±€å˜é‡åï¼Œå°†å…¨å±€å˜é‡åŽ‹å…¥æ ˆï¼‰ã€‚   |
| **12**   | `STORE_GLOBAL`      | 0xC         | 16ä½å¸¸é‡ç´¢å¼•               | æ ˆé¡¶å€¼                            | â€”                          | å­˜å‚¨å…¨å±€å˜é‡ï¼ˆä»Žå¸¸é‡æ± èŽ·å–å…¨å±€å˜é‡åï¼Œå°†å…¨å±€å˜é‡è®¾ç½®ä¸ºæ ˆé¡¶å€¼ï¼‰ã€‚ |
| **13**   | `LOAD_FIELD`        | 0xD         | 16ä½å¸¸é‡ç´¢å¼•               | æ ˆé¡¶å€¼                            | `push(field_val)`          | è®¿é—®å¯¹è±¡å­—æ®µã€‚                                               |
| **14**   | `STORE_FIELD`       | 0xE         | 16ä½å¸¸é‡ç´¢å¼•               | ä¸¤ä¸ªæ ˆé¡¶å€¼`val`, `obj`            | `pop()`                    | è®¾ç½®å¯¹è±¡å­—æ®µã€‚                                               |
| **15**   | `LOAD_SUBSCR`       | 0xF         | 16ä½å¸¸é‡ç´¢å¼•               | ä¸¤ä¸ªæ ˆé¡¶å€¼`obj`, `index`          | `pop(2) + push(index_val)` | æ‰§è¡Œä¸‹æ ‡è®¿é—®ã€‚                                               |
| **16**   | `STORE_SUBSCR`      | 0x10        | 16ä½å¸¸é‡ç´¢å¼•               | ä¸‰ä¸ªæ ˆé¡¶å€¼`val`,`obj`, `index`    | `pop(2)`                   | æ‰§è¡Œä¸‹æ ‡èµ‹å€¼ã€‚                                               |
| **17**   | `EQUAL`             | 0x11        | â€”                          | ä¸¤ä¸ªæ ˆé¡¶å€¼`a`, `b`                | `pop(2) + push(a==b)`      | æ¯”è¾ƒç›¸ç­‰ã€‚                                                   |
| **18**   | `NOT_EQUAL`         | 0x12        | â€”                          | ä¸¤ä¸ªæ ˆé¡¶å€¼`a`, `b`                | `pop(2) + push(a!=b)`      | æ¯”è¾ƒä¸ç­‰ã€‚                                                   |
| **19**   | `GREATER`           | 0x13        | â€”                          | ä¸¤ä¸ªæ ˆé¡¶å€¼`a`, `b`                | `pop(2) + push(a>b)`       | æ¯”è¾ƒ `a > b`ã€‚                                               |
| **20**   | `GREATER_EQUAL`     | 0x14        | â€”                          | ä¸¤ä¸ªæ ˆé¡¶å€¼`a`, `b`                | `pop(2) + push(a>=b)`      | æ¯”è¾ƒ `a >= b`ã€‚                                              |
| **21**   | `LESS`              | 0x15        | â€”                          | ä¸¤ä¸ªæ ˆé¡¶å€¼`a`, `b`                | `pop(2) + push(a<b)`       | æ¯”è¾ƒ `a < b`ã€‚                                               |
| **22**   | `LESS_EQUAL`        | 0x16        | â€”                          | ä¸¤ä¸ªæ ˆé¡¶å€¼`a`, `b`                | `pop(2) + push(a<=b)`      | æ¯”è¾ƒ `a <= b`ã€‚                                              |
| **23**   | `ADD`               | 0x17        | â€”                          | ä¸¤ä¸ªæ ˆé¡¶å€¼`a`, `b`                | `pop(2) + push(a+b)`       | æ•°å€¼åŠ æ³•æˆ–å­—ç¬¦ä¸²æ‹¼æŽ¥ã€‚                                       |
| **24**   | `SUBTRACT`          | 0x18        | â€”                          | ä¸¤ä¸ªæ ˆé¡¶å€¼`a`, `b`                | `pop(2) + push(a-b)`       | æ•°å€¼å‡æ³•ã€‚                                                   |
| **25**   | `MULTIPLY`          | 0x19        | â€”                          | ä¸¤ä¸ªæ ˆé¡¶å€¼`a`, `b`                | `pop(2) + push(a*b)`       | æ•°å€¼ä¹˜æ³•ã€‚                                                   |
| **26**   | `DIVIDE`            | 0x1A        | â€”                          | ä¸¤ä¸ªæ ˆé¡¶å€¼`a`, `b`                | `pop(2) + push(a/b)`       | æ•°å€¼é™¤æ³•ï¼ˆæ£€æŸ¥é™¤é›¶ï¼‰ã€‚                                       |
| **27**   | `MOD`               | 0x1B        | â€”                          | ä¸¤ä¸ªæ ˆé¡¶å€¼`a`, `b`                | `pop(2) + push(a%b)`       | æ•°å€¼å–æ¨¡ï¼ˆæ£€æŸ¥é™¤é›¶ï¼‰ã€‚                                       |
| **28**   | `NOT`               | 0x1C        | â€”                          | æ ˆé¡¶å€¼`a`                         | `pop() + push(!a)`         | å¸ƒå°”å–åã€‚                                                   |
| **29**   | `NEGATE`            | 0x1D        | â€”                          | æ ˆé¡¶å€¼`a`                         | `pop() + push(-a)`         | æ•°å€¼å–è´Ÿã€‚                                                   |
| **30**   | `POP`               | 0x1E        | â€”                          | â€”                                 | `pop()`                    | å¼¹å‡ºä¸€ä¸ªå€¼ã€‚                                                 |
| **31**   | `POP_N`             | 0x1F        | 8ä½n                       | â€”                                 | `pop(n)`                   | ä¸€æ¬¡å¼¹å‡ºå¤šä¸ªå€¼ã€‚                                             |
| **32**   | `PRINT`             | 0x20        | â€”                          | æ ˆé¡¶å€¼                            | `pop()`                    | æ‰“å°å¹¶å¼¹å‡ºæ ˆé¡¶å€¼ã€‚                                           |
| **33**   | `NOP`               | 0x21        | â€”                          | â€”                                 | â€”                          | ç©ºæ“ä½œã€‚                                                     |
| **34**   | `JUMP_FWD`          | 0x22        | 16ä½åç§»é‡                 | â€”                                 | â€”                          | æ— æ¡ä»¶å‘å‰è·³è½¬ï¼ˆ`ip -= offset`ï¼‰ã€‚                           |
| **35**   | `JUMP_BWD`          | 0x23        | 16ä½åç§»é‡                 | â€”                                 | â€”                          | æ— æ¡ä»¶å‘åŽè·³è½¬ï¼ˆ`ip += offset`ï¼‰ã€‚                           |
| **36**   | `JUMP_TRUE`         | 0x24        | 16ä½åç§»é‡                 | æ ˆé¡¶å€¼                            | `pop()`                    | è‹¥æ¡ä»¶ä¸ºçœŸåˆ™è·³è½¬ï¼ˆ`ip += offset`ï¼‰ã€‚                         |
| **37**   | `JUMP_TRUE_NOPOP`   | 0x25        | 16ä½åç§»é‡                 | æ ˆé¡¶å€¼                            | â€”                          | è‹¥æ¡ä»¶ä¸ºçœŸåˆ™è·³è½¬ï¼ˆä¿ç•™æ¡ä»¶å€¼ï¼Œ`ip += offset`ï¼‰ã€‚             |
| **38**   | `JUMP_FALSE`        | 0x26        | 16ä½åç§»é‡                 | æ ˆé¡¶å€¼                            | `pop()`                    | è‹¥æ¡ä»¶ä¸ºå‡åˆ™è·³è½¬ï¼ˆ`ip += offset`ï¼‰ã€‚                         |
| **39**   | `JUMP_FALSE_NOPOP`  | 0x27        | 16ä½åç§»é‡                 | æ ˆé¡¶å€¼                            | â€”                          | è‹¥æ¡ä»¶ä¸ºå‡åˆ™è·³è½¬ï¼ˆä¿ç•™æ¡ä»¶å€¼ï¼Œ`ip += offset`ï¼‰ã€‚             |
| **40**   | `CALL`              | 0x28        | 8ä½å‚æ•°ä¸ªæ•°(n)             | n+1ä¸ªæ ˆé¡¶å€¼`callee(1)`, `args(n)` | â€”                          | è°ƒç”¨å‡½æ•°ã€‚                                                   |
| **41**   | `CLOSURE`           | 0x29        | 16ä½å¸¸é‡ç´¢å¼•+24nä½é—­åŒ…å‚æ•° | â€”                                 | â€”                          | åˆ›å»ºé—­åŒ…ã€‚                                                   |
| **42**   | `MAKE_CLASS`        | 0x2A        | 16ä½å¸¸é‡ç´¢å¼•               | â€”                                 | `push(class)`              | åˆ›å»ºç±»å¯¹è±¡ã€‚                                                 |
| **43**   | `INHERIT`           | 0x2B        |                            |                                   |                            | å»ºç«‹ç»§æ‰¿å…³ç³»ï¼ˆæœªå®žçŽ°ï¼‰ã€‚                                     |
| **44**   | `MAKE_METHOD`       | 0x2C        |                            |                                   |                            | å®šä¹‰ç±»æ–¹æ³•ï¼ˆæœªå®žçŽ°ï¼‰ã€‚                                       |
| **45**   | `MAKE_INIT_METHOD`  | 0x2D        |                            |                                   |                            | å®šä¹‰æž„é€ æ–¹æ³•ï¼ˆæœªå®žçŽ°ï¼‰ã€‚                                     |
| **46**   | `INVOKE_METHOD`     | 0x2E        |                            |                                   |                            | è°ƒç”¨å¯¹è±¡æ–¹æ³•ï¼ˆæœªå®žçŽ°ï¼‰ã€‚                                     |
| **47**   | `LOAD_SUPER_METHOD` | 0x2F        |                            |                                   |                            | åŠ è½½çˆ¶ç±»æ–¹æ³•ï¼ˆæœªå®žçŽ°ï¼‰ã€‚                                     |
| **48**   | `MAKE_LIST`         | 0x30        |                            |                                   |                            | åˆ›å»ºåˆ—è¡¨å¯¹è±¡ï¼ˆæœªå®žçŽ°ï¼‰ã€‚                                     |
| **49**   | `MAKE_MAP`          | 0x31        |                            |                                   |                            | åˆ›å»ºå­—å…¸å¯¹è±¡ï¼ˆæœªå®žçŽ°ï¼‰ã€‚                                     |
| **50**   | `IMPORT`            | 0x32        |                            |                                   |                            | å¯¼å…¥æ¨¡å—ï¼ˆæœªå®žçŽ°ï¼‰ã€‚                                         |
| **51**   | `GET_ITER`          | 0x33        |                            |                                   |                            | èŽ·å–è¿­ä»£å™¨ï¼ˆæœªå®žçŽ°ï¼‰ã€‚                                       |
| **52**   | `ITER_HAS_NEXT`     | 0x34        |                            |                                   |                            | åˆ¤æ–­è¿­ä»£å™¨æ˜¯å¦ç»“æŸï¼ˆæœªå®žçŽ°ï¼‰ã€‚                               |
| **53**   | `ITER_GET_NEXT`     | 0x35        |                            |                                   |                            | èŽ·å–è¿­ä»£å™¨ä¸‹ä¸€ä¸ªå€¼ï¼ˆæœªå®žçŽ°ï¼‰ã€‚                               |
| **54**   | `SETUP_EXCEPT`      | 0x36        |                            |                                   |                            | è¿›å…¥å¼‚å¸¸æ•èŽ·å—ï¼ˆæœªå®žçŽ°ï¼‰ã€‚                                   |
| **55**   | `END_EXCEPT`        | 0x37        |                            |                                   |                            | ç»“æŸå¼‚å¸¸æ•èŽ·å—ï¼ˆæœªå®žçŽ°ï¼‰ã€‚                                   |
| **56**   | `THROW`             | 0x38        |                            |                                   |                            | æŠ›å‡ºå¼‚å¸¸ï¼ˆæœªå®žçŽ°ï¼‰ã€‚                                         |
| **57**   | `RETURN`            | 0x39        | â€”                          | æ ˆé¡¶å€¼                            | `pop() + æ¢å¤ä¸Šå±‚å¸§`       | ç»“æŸå½“å‰å‡½æ•°å¹¶è¿”å›žæ ˆé¡¶å€¼ï¼›è‹¥ä¸»è„šæœ¬å¸§è¿”å›žåˆ™ç»“æŸæ‰§è¡Œã€‚         |

------

## ðŸ§  æ ˆè¡Œä¸ºå¯è§†åŒ–ç¤ºä¾‹

### `ADD`ï¼ˆéšå¼æ“ä½œæ•°ï¼‰

```
æ ˆæ‰§è¡Œå‰: [a, b]
æŒ‡ä»¤: ADD
è¯»å–éšå¼æ“ä½œæ•°: a = pop(), b = pop()
æ‰§è¡Œç»“æžœ: a + b
åŽ‹æ ˆ: push(result)
æœ€ç»ˆæ ˆ: [result]
```

### `JUMP_FALSE`ï¼ˆæ˜¾å¼åç§»é‡ï¼‰

```
æ ˆæ‰§è¡Œå‰: [cond]
æŒ‡ä»¤æµ: JUMP_FALSE <offset_low> <offset_high>
è¯»å–æ˜¾å¼æ“ä½œæ•°: offset = read_word()
å¦‚æžœ cond ä¸ºå‡:
    frame->ip += offset
å¦åˆ™ç»§ç»­
æ ˆå˜åŒ–: pop()
```

### `RETURN`

```
æ ˆæ‰§è¡Œå‰: [..., function_frame, return_value]
æ“ä½œ:
    pop() â†’ result
    è‹¥æ— ä¸Šå±‚å¸§ â†’ è¿”å›ž SUCCESS
    å¦åˆ™æ¢å¤ä¸Šå±‚å¸§å¹¶ push(result)
```

------





## âš™ï¸ æŒ‡ä»¤å¸ƒå±€è¡¨

| ç¼–å·   | æŒ‡ä»¤å              | äºŒè¿›åˆ¶æ ¼å¼ï¼ˆæ“ä½œæ•°å­—æ®µï¼‰        | æŒ‡ä»¤é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰ | åŠŸèƒ½æ¦‚è¿°                         |
| ------ | ------------------- | ------------------------------- | ---------------- | -------------------------------- |
| **1**  | `LOAD_CONST`        | `[uint8_op uint16_const_index]` | 3                | ä»Žå¸¸é‡æ± åŠ è½½å¸¸é‡å¹¶åŽ‹æ ˆ           |
| **2**  | `LOAD_NIL`          | `[uint8_op]`                    | 1                | åŽ‹å…¥ nil                         |
| **3**  | `LOAD_TRUE`         | `[uint8_op]`                    | 1                | åŽ‹å…¥ true                        |
| **4**  | `LOAD_FALSE`        | `[uint8_op]`                    | 1                | åŽ‹å…¥ false                       |
| **5**  | `LOAD_LOCAL`        | â€”                               |                  |                                  |
| **6**  | `STORE_LOCAL`       | â€”                               |                  |                                  |
| **7**  | `LOAD_UPVALUE`      | â€”                               |                  |                                  |
| **8**  | `STORE_UPVALUE`     | â€”                               |                  |                                  |
| **9**  | `CLOSE_UPVALUE`     | â€”                               |                  |                                  |
| **10** | `DEF_GLOBAL`        | â€”                               |                  |                                  |
| **11** | `LOAD_GLOBAL`       | â€”                               |                  |                                  |
| **12** | `STORE_GLOBAL`      | â€”                               |                  |                                  |
| **13** | `LOAD_FIELD`        | â€”                               |                  |                                  |
| **14** | `STORE_FIELD`       | â€”                               |                  |                                  |
| **15** | `LOAD_SUBSCR`       | â€”                               |                  |                                  |
| **16** | `STORE_SUBSCR`      | â€”                               |                  |                                  |
| **17** | `EQUAL`             | `[uint8_op]`                    | 1                | æ¯”è¾ƒç›¸ç­‰ (`a == b`)              |
| **18** | `NOT_EQUAL`         | `[uint8_op]`                    | 1                | æ¯”è¾ƒä¸ç›¸ç­‰ (`a != b`)            |
| **19** | `GREATER`           | `[uint8_op]`                    | 1                | æ¯”è¾ƒ `a > b`                     |
| **20** | `GREATER_EQUAL`     | `[uint8_op]`                    | 1                | æ¯”è¾ƒ `a >= b`                    |
| **21** | `LESS`              | `[uint8_op]`                    | 1                | æ¯”è¾ƒ `a < b`                     |
| **22** | `LESS_EQUAL`        | `[uint8_op]`                    | 1                | æ¯”è¾ƒ `a <= b`                    |
| **23** | `ADD`               | `[uint8_op]`                    | 1                | æ•°å­—ç›¸åŠ æˆ–å­—ç¬¦ä¸²æ‹¼æŽ¥             |
| **24** | `SUBTRACT`          | `[uint8_op]`                    | 1                | æ•°å­—ç›¸å‡                         |
| **25** | `MULTIPLY`          | `[uint8_op]`                    | 1                | æ•°å­—ç›¸ä¹˜                         |
| **26** | `DIVIDE`            | `[uint8_op]`                    | 1                | æ•°å­—ç›¸é™¤                         |
| **27** | `MOD`               | `[uint8_op]`                    | 1                | æ•°å­—å–æ¨¡                         |
| **28** | `NOT`               | `[uint8_op]`                    | 1                | å¸ƒå°”å–å                         |
| **29** | `NEGATE`            | `[uint8_op]`                    | 1                | æ•°å­—å–è´Ÿ                         |
| **30** | `POP`               | `[uint8_op]`                    | 1                | å¼¹å‡ºä¸€ä¸ªå€¼                       |
| **31** | `POP_N`             | `[uint8_op uint8_count]`        | 2                | ä¸€æ¬¡å¼¹å‡ºå¤šä¸ªå€¼                   |
| **32** | `PRINT`             | `[uint8_op]`                    | 1                | è¾“å‡ºå¹¶å¼¹æ ˆ                       |
| **33** | `NOP`               | `[uint8_op]`                    | 1                | ç©ºæ“ä½œ                           |
| **34** | `JUMP_FWD`          | `[uint8_op uint16_offset]`      | 3                | æ— æ¡ä»¶è·³è½¬ï¼ˆå‰å‘ï¼‰               |
| **35** | `JUMP_BWD`          | `[uint8_op uint16_offset]`      | 3                | æ— æ¡ä»¶è·³è½¬ï¼ˆåŽå‘ï¼‰               |
| **36** | `JUMP_TRUE`         | `[uint8_op uint16_offset]`      | 3                | æ¡ä»¶ä¸ºçœŸè·³è½¬ï¼ˆå¼¹æ ˆï¼‰             |
| **37** | `JUMP_TRUE_NOPOP`   | `[uint8_op uint16_offset]`      | 3                | æ¡ä»¶ä¸ºçœŸè·³è½¬ï¼ˆä¸å¼¹æ ˆï¼‰           |
| **38** | `JUMP_FALSE`        | `[uint8_op uint16_offset]`      | 3                | æ¡ä»¶ä¸ºå‡è·³è½¬ï¼ˆå¼¹æ ˆï¼‰             |
| **39** | `JUMP_FALSE_NOPOP`  | `[uint8_op uint16_offset]`      | 3                | æ¡ä»¶ä¸ºå‡è·³è½¬ï¼ˆä¸å¼¹æ ˆï¼‰           |
| **40** | `CALL`              | `[uint8_op uint8_arg_count]`    | 2                |                                  |
| **41** | `CLOSURE`           | â€”                               |                  |                                  |
| **42** | `MAKE_CLASS`        | â€”                               |                  |                                  |
| **43** | `INHERIT`           | â€”                               |                  |                                  |
| **44** | `MAKE_METHOD`       | â€”                               |                  |                                  |
| **45** | `MAKE_INIT_METHOD`  | â€”                               |                  |                                  |
| **46** | `INVOKE_METHOD`     | â€”                               |                  |                                  |
| **47** | `LOAD_SUPER_METHOD` | â€”                               |                  |                                  |
| **48** | `MAKE_LIST`         | â€”                               |                  |                                  |
| **49** | `MAKE_MAP`          | â€”                               |                  |                                  |
| **50** | `IMPORT`            | â€”                               |                  |                                  |
| **51** | `GET_ITER`          | â€”                               |                  |                                  |
| **52** | `ITER_HAS_NEXT`     | â€”                               |                  |                                  |
| **53** | `ITER_GET_NEXT`     | â€”                               |                  |                                  |
| **54** | `SETUP_EXCEPT`      | â€”                               |                  |                                  |
| **55** | `END_EXCEPT`        | â€”                               |                  |                                  |
| **56** | `THROW`             | â€”                               |                  |                                  |
| **57** | `RETURN`            | `[uint8_op]`                    | 1                | å‡½æ•°è¿”å›žï¼›è‹¥ä¸ºä¸»è„šæœ¬å¸§åˆ™ç»“æŸæ‰§è¡Œ |